---
phase: 06-project-details-page
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/pages/hud/hud-container/hud-container.page.html
  - src/app/pages/hud/hud-container/hud-container.page.ts
  - src/app/pages/hud/hud-container/hud-container.page.scss
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "HUD container has router-outlet that renders child routes"
    - "HUD main page (2 navigation cards) renders when navigating to /hud/{projectId}/{serviceId}"
    - "HUD project details page renders when navigating to /hud/{projectId}/{serviceId}/project-details"
    - "HUD category detail page renders when navigating to /hud/{projectId}/{serviceId}/category/hud"
  artifacts:
    - path: "src/app/pages/hud/hud-container/hud-container.page.html"
      provides: "Container with router-outlet (matching EFE pattern)"
    - path: "src/app/pages/hud/hud-container/hud-container.page.scss"
      provides: "Container styles including router-wrapper and loading overlay"
  key_links:
    - from: "src/app/pages/hud/hud-container/hud-container.page.html"
      to: "router-outlet"
      via: "Angular router"
      pattern: "<router-outlet>"
---

<objective>
Fix HUD container to use router-outlet pattern so child routes (HudMainPage, HudProjectDetailsPage, HudCategoryDetailPage) actually render.

Purpose: The HUD container currently has all form content directly in its template with NO router-outlet. This means child routes defined in app-routing never render - users see the old monolithic form instead of the new navigation-based structure.

Output: HUD container refactored to match engineers-foundation-container pattern with working child route rendering
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Reference: EFE container pattern (the target)
@src/app/pages/engineers-foundation/engineers-foundation-container/engineers-foundation-container.page.html
@src/app/pages/engineers-foundation/engineers-foundation-container/engineers-foundation-container.page.scss

# Target files to refactor
@src/app/pages/hud/hud-container/hud-container.page.html
@src/app/pages/hud/hud-container/hud-container.page.ts
@src/app/pages/hud/hud-container/hud-container.page.scss
</context>

<tasks>

<task type="auto">
  <name>Task 1: Refactor HUD container HTML to router-outlet pattern</name>
  <files>
    src/app/pages/hud/hud-container/hud-container.page.html
    src/app/pages/engineers-foundation/engineers-foundation-container/engineers-foundation-container.page.html
  </files>
  <action>
Replace the entire HUD container HTML with the router-outlet pattern matching EFE:

**Target structure (from engineers-foundation-container):**
```html
<ion-header>
  <ion-toolbar>
    <!-- Back button -->
    <!-- Title (dynamic based on current page) -->
    <!-- Toolbar actions (sync widget mobile only, PDF button) -->
  </ion-toolbar>
</ion-header>

<ion-content>
  <!-- Loading overlay (CSS visibility, NOT *ngIf) -->
  <div class="template-loading-overlay" [class.hidden]="templateReady">
    <!-- Loading spinner and progress message -->
  </div>

  <!-- Router wrapper - ALWAYS mounted, use CSS to hide when loading -->
  <div class="router-wrapper" [class.loading]="!templateReady">
    <router-outlet></router-outlet>
  </div>
</ion-content>

<ion-footer class="breadcrumb-footer">
  <!-- Breadcrumb navigation -->
</ion-footer>
```

**Key differences for HUD:**
1. Title: "HUD / Mobile Manufactured" (or dynamic based on page)
2. Breadcrumbs: Adapt labels for HUD pages (Main, Project Details, HUD Category)
3. Keep existing header styling (template-toolbar class) if it works

**CRITICAL:**
- The router-outlet MUST be present and NOT wrapped in *ngIf
- Use CSS class toggling (hidden/loading) instead of *ngIf to show/hide
- Remove ALL form content currently in the template (it lives in child pages now)

**Preserve from current HUD container:**
- goBack() button functionality
- generatePDF() button functionality
- Offline warning banner (if applicable)
- Toolbar styling
  </action>
  <verify>
    - router-outlet tag is present in the HTML
    - No *ngIf on router-outlet or its wrapper
    - Loading overlay uses [class.hidden] pattern
    - Router wrapper uses [class.loading] pattern
    - All old form content removed
  </verify>
  <done>HUD container HTML refactored with router-outlet</done>
</task>

<task type="auto">
  <name>Task 2: Add required properties and imports to HUD container TypeScript</name>
  <files>
    src/app/pages/hud/hud-container/hud-container.page.ts
    src/app/pages/engineers-foundation/engineers-foundation-container/engineers-foundation-container.page.ts
  </files>
  <action>
Ensure HUD container TypeScript has the properties needed for the new template:

**Required properties (add if missing):**
```typescript
templateReady: boolean = false;
downloadProgress: string = 'Loading template...';
breadcrumbs: Breadcrumb[] = [];
currentPageTitle: string = 'HUD / Mobile Manufactured';
currentPageShortTitle: string = 'HUD';
isSubPage: boolean = false;
```

**Required imports (add if missing):**
```typescript
import { Router, NavigationEnd } from '@angular/router';
import { filter } from 'rxjs/operators';
```

**Required interface (add if missing):**
```typescript
interface Breadcrumb {
  label: string;
  path: string;
  icon?: string;
}
```

**Add updateBreadcrumbs() method** that:
1. Subscribes to router.events NavigationEnd
2. Parses current URL to determine page
3. Sets breadcrumbs array based on URL:
   - Base: "HUD" (icon: construct-outline)
   - /project-details: + "Project Details" (icon: document-text-outline)
   - /category/hud: + "HUD Category" (icon: checkbox-outline)
4. Updates currentPageTitle based on current page

**Ensure existing methods preserved:**
- goBack() - may need update for hierarchical navigation
- generatePDF() - keep as-is
- ngOnInit() data loading logic
- ionViewWillEnter() refresh logic

**Set templateReady = true** after initial data load completes (in existing ngOnInit flow)
  </action>
  <verify>
    - templateReady property exists and is set to true after data loads
    - downloadProgress property exists
    - breadcrumbs array exists
    - updateBreadcrumbs() method exists and subscribes to router events
    - RouterModule imported in component
  </verify>
  <done>HUD container TypeScript updated with router-outlet support properties</done>
</task>

<task type="auto">
  <name>Task 3: Add router-wrapper and loading overlay styles to HUD container SCSS</name>
  <files>
    src/app/pages/hud/hud-container/hud-container.page.scss
    src/app/pages/engineers-foundation/engineers-foundation-container/engineers-foundation-container.page.scss
  </files>
  <action>
Add the CSS styles needed for the router-outlet pattern.

**Add these styles (from EFE container):**

```scss
// Loading overlay - use CSS visibility to prevent destroying router-outlet
.template-loading-overlay {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: var(--ion-background-color, #f5f5f5);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
  transition: opacity 0.3s ease;

  &.hidden {
    opacity: 0;
    pointer-events: none;
  }

  .loading-content {
    text-align: center;

    ion-spinner {
      width: 48px;
      height: 48px;
      margin-bottom: 16px;
    }

    h2 {
      margin: 0 0 8px;
      font-size: 18px;
      font-weight: 500;
    }

    p {
      margin: 0;
      color: var(--ion-color-medium);
      font-size: 14px;
    }

    .loading-hint {
      margin-top: 8px;
      font-size: 12px;
      color: var(--ion-color-medium-shade);
    }
  }
}

// Router wrapper - ensures child components persist across loading state changes
.router-wrapper {
  height: 100%;
  width: 100%;

  // When loading, hide but don't destroy child components
  &.loading {
    visibility: hidden;
    height: 0;
    overflow: hidden;
  }
}

// Breadcrumb footer
.breadcrumb-footer {
  ion-toolbar {
    --background: #ffffff;
    --border-width: 1px 0 0 0;
    --border-color: #e0e0e0;
    --padding-start: 0;
    --padding-end: 0;
    --min-height: 44px;
  }

  .breadcrumb-container {
    display: flex;
    align-items: center;
    padding: 8px 16px;
    gap: 8px;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;

    &::-webkit-scrollbar {
      display: none;
    }
  }

  .breadcrumb-item {
    display: flex;
    align-items: center;
    gap: 4px;
    color: var(--ion-color-medium);
    font-size: 14px;
    white-space: nowrap;
    cursor: pointer;
    padding: 4px 8px;
    border-radius: 4px;
    transition: background-color 0.2s;

    &:hover {
      background-color: rgba(0, 0, 0, 0.05);
    }

    &.active {
      color: var(--ion-color-primary);
      font-weight: 500;
    }

    ion-icon {
      font-size: 18px;
    }
  }

  .breadcrumb-arrow {
    color: var(--ion-color-medium-tint);
    font-size: 12px;
    flex-shrink: 0;
  }
}
```

**Keep existing HUD container styles** for:
- Toolbar styling (template-toolbar, etc.)
- Offline warning banner
- Any HUD-specific button styles
  </action>
  <verify>
    - .template-loading-overlay styles exist with .hidden modifier
    - .router-wrapper styles exist with .loading modifier
    - .breadcrumb-footer styles exist
    - Existing toolbar styles preserved
  </verify>
  <done>HUD container SCSS updated with router-outlet support styles</done>
</task>

<task type="auto">
  <name>Task 4: Verify routing works end-to-end</name>
  <files>
    src/app/app-routing.module.ts
    src/app/pages/hud/hud-routing.module.ts
  </files>
  <action>
Verify the routing configuration is correct and complete:

1. **Check app-routing.module.ts** has:
   ```typescript
   {
     path: 'hud/:projectId/:serviceId',
     component: HudContainerPage,
     children: [
       { path: '', component: HudMainPage },
       { path: 'project-details', component: HudProjectDetailsPage },
       { path: 'category/:category', component: HudCategoryDetailPage }
     ]
   }
   ```

2. **Check hud-routing.module.ts** is consistent (or remove if app-routing handles all HUD routes)

3. **Verify imports** in app-routing.module.ts:
   - HudContainerPage
   - HudMainPage
   - HudProjectDetailsPage
   - HudCategoryDetailPage

4. **Test navigation paths:**
   - `/hud/{projectId}/{serviceId}` → should render HudMainPage (2 cards)
   - `/hud/{projectId}/{serviceId}/project-details` → should render HudProjectDetailsPage
   - `/hud/{projectId}/{serviceId}/category/hud` → should render HudCategoryDetailPage

Document any routing issues found for fixing.
  </action>
  <verify>
    - app-routing.module.ts has correct HUD routes with children
    - All HUD page components are imported
    - No duplicate route definitions causing conflicts
  </verify>
  <done>Routing configuration verified correct</done>
</task>

</tasks>

<verification>
After completion, verify:
1. Navigate to HUD template from project-detail page
2. HudMainPage renders showing 2 navigation cards (Project Details, HUD / Mobile Manufactured)
3. Click "Project Details" → HudProjectDetailsPage renders
4. Click back → returns to HudMainPage
5. Breadcrumbs update correctly as you navigate
6. Loading overlay shows briefly then hides (templateReady works)
</verification>

<success_criteria>
- HUD container HTML has router-outlet tag
- Child routes actually render (not the old monolithic form)
- Navigation between HUD pages works
- Loading overlay and breadcrumbs function correctly
- No console errors during navigation
</success_criteria>

<output>
After completion, create `.planning/phases/06-project-details-page/06-02-SUMMARY.md`
</output>
