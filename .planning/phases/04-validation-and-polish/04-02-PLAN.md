---
phase: 04-validation-and-polish
plan: 02
type: execute
wave: 2
depends_on: ["04-01"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "Data persists correctly after app restart (IndexedDB survives)"
    - "Offline operations sync correctly when connectivity returns"
    - "Finalization syncs all changes before completing"
    - "IndexedDB connection errors recover gracefully without data loss"
  artifacts: []
  key_links: []
---

<objective>
Validate end-to-end HUD Dexie-first implementation through manual device testing.

Purpose: This is a validation phase that verifies all prior implementation phases (1-3) work together correctly as an end-to-end system, plus validates the finalization fixes from 04-01.

Output: Validated HUD template matching engineers-foundation behavior.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-validation-and-polish/04-RESEARCH.md
@.planning/phases/04-validation-and-polish/04-01-SUMMARY.md
</context>

<tasks>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
    Complete HUD Dexie-first mobile implementation including:
    - Phase 1: Container rehydration and service tracking
    - Phase 2: Data service cache invalidation and sync subscriptions
    - Phase 3: Category detail liveQuery and mobile styling
    - Phase 4-01: Finalization sync fixes (data sync step + dirty flag cleanup)
  </what-built>
  <how-to-verify>
    Run these test cases on a mobile device (iOS or Android):

    **TC-01: Data Persistence After App Restart**
    1. Navigate to HUD category detail
    2. Make some field changes (toggle items, update values)
    3. Note the current values
    4. Force-kill app (swipe away on iOS/Android)
    5. Relaunch app and navigate back to same category
    6. VERIFY: All field values exactly as before restart

    **TC-02: Offline Operations Sync on Reconnect**
    1. Enable airplane mode on device
    2. Make field changes in HUD category detail
    3. Take 2 photos
    4. Disable airplane mode
    5. Wait 30 seconds for background sync
    6. VERIFY: All changes appear on server (check Caspio webapp or API)

    **TC-03: Finalization Syncs Before Completing**
    1. Make field changes in HUD category detail (while online)
    2. Immediately tap Finalize (before background sync runs - within 5 seconds of change)
    3. Watch loading messages
    4. VERIFY: See "Syncing data..." message during finalization
    5. VERIFY: All field changes synced to server after finalization

    **TC-04: Rehydration After Purge**
    1. Complete and finalize an HUD service
    2. Navigate away (let smart purge run)
    3. Navigate back to the same HUD service
    4. Observe loading overlay
    5. VERIFY: Data restores correctly from server (rehydration works)

    If any test case fails, describe which one and the specific failure behavior.
  </how-to-verify>
  <resume-signal>
    Type one of:
    - "all tests passed" - proceed to mark phase complete
    - "TC-XX failed: [description]" - will create gap closure plan
  </resume-signal>
</task>

</tasks>

<verification>
This is a human verification checkpoint. No automated verification possible.
The user's test results determine phase success.
</verification>

<success_criteria>
- All 4 test cases pass on device
- User confirms HUD behavior matches engineers-foundation
- No orphaned data after finalization
- No data loss after app restart
- Rehydration works after purge
</success_criteria>

<output>
After verification confirmation, create `.planning/phases/04-validation-and-polish/04-02-SUMMARY.md` with test results.
</output>
