---
phase: 05-navigation-refactor
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/pages/hud/hud-container/hud-container.page.ts
autonomous: true

must_haves:
  truths:
    - "Back button from project-details navigates to HUD main page"
    - "Back button from category page navigates to HUD main page"
    - "Back button from HUD main page navigates to project detail"
  artifacts:
    - path: "src/app/pages/hud/hud-container/hud-container.page.ts"
      provides: "URL-based hierarchical goBack navigation"
      contains: "goBack"
  key_links:
    - from: "hud-container.page.ts goBack()"
      to: "/hud route"
      via: "router.navigate"
      pattern: "router\\.navigate\\(\\['/hud'"
    - from: "hud-container.page.ts goBack()"
      to: "/project route"
      via: "router.navigate"
      pattern: "router\\.navigate\\(\\['/project'"
---

<objective>
Update HUD container goBack() method to use URL-based hierarchical navigation.

Purpose: Replace location.back() with explicit router navigation that follows URL hierarchy, matching engineers-foundation pattern.
Output: Back button correctly navigates up the page hierarchy (sub-page -> main -> project).
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/05-navigation-refactor/05-RESEARCH.md

Reference files:
@src/app/pages/hud/hud-container/hud-container.page.ts
@src/app/pages/engineers-foundation/engineers-foundation-container/engineers-foundation-container.page.ts (lines 424-451 for goBack pattern)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Replace goBack() with URL-based hierarchical navigation</name>
  <files>src/app/pages/hud/hud-container/hud-container.page.ts</files>
  <action>
Find the goBack() method (around line 1415) and replace its implementation with URL-based navigation.

Current implementation uses `this.location.back()` which relies on browser history.
New implementation should parse URL and navigate explicitly:

```typescript
goBack(event?: Event) {
  console.log('[HUD Container] goBack called');

  // Prevent default and stop propagation
  if (event) {
    event.preventDefault();
    event.stopPropagation();
  }

  // Navigate up one level in the URL hierarchy
  const url = this.router.url;
  console.log('[HUD Container] Current URL:', url);

  if (url.includes('/category/')) {
    // On category detail page - navigate to HUD main
    console.log('[HUD Container] On category page, navigating to HUD main');
    this.router.navigate(['/hud', this.projectId, this.serviceId]);
  } else if (url.includes('/project-details')) {
    // On project details page - navigate to HUD main
    console.log('[HUD Container] On project-details, navigating to HUD main');
    this.router.navigate(['/hud', this.projectId, this.serviceId]);
  } else {
    // On HUD main page - navigate to project detail
    console.log('[HUD Container] On main page, navigating to project detail');
    this.router.navigate(['/project', this.projectId]);
  }
}
```

IMPORTANT:
- Remove the try/catch with location.back()
- Remove the fallback navigation using '\project' (note: existing code has backslashes which are likely bugs)
- The Router import should already exist at the top of the file
- Keep the event handling at the beginning (preventDefault, stopPropagation)
  </action>
  <verify>
1. Search for "location.back()" in hud-container.page.ts - should return 0 occurrences
2. Search for "router.navigate(['/hud'" - should find it in goBack()
3. Search for "router.navigate(['/project'" - should find it in goBack()
  </verify>
  <done>goBack() navigates via router based on URL hierarchy, not browser history</done>
</task>

<task type="auto">
  <name>Task 2: Clean up unused location.back() references</name>
  <files>src/app/pages/hud/hud-container/hud-container.page.ts</files>
  <action>
After updating goBack(), check if the `Location` import from '@angular/common' is still needed elsewhere in the file.

Search the file for other usages of `this.location.`:
- If Location is ONLY used in goBack(), it may now be unused
- If Location is used elsewhere (e.g., location.path()), keep the import

If the Location import becomes completely unused:
1. Remove `import { Location } from '@angular/common';` (or remove Location from the combined import)
2. Remove `private location: Location` from constructor parameters

Note: The file likely uses CommonModule which is different from the Location service. Only remove the Location SERVICE import if it exists and is unused.
  </action>
  <verify>
1. If Location import was removed: verify no "this.location" calls exist
2. If Location import was kept: verify it's used somewhere other than goBack()
3. File should compile without errors (TypeScript should not complain about missing imports)
  </verify>
  <done>Unused imports cleaned up, file is consistent</done>
</task>

</tasks>

<verification>
1. Search for "location.back()" - should return 0 matches
2. Search for "/hud" in goBack() context - should show URL-based navigation
3. Search for "/project" in goBack() context - should show project navigation fallback
4. Verify the navigation pattern matches EFE container (URL parsing, not history)
</verification>

<success_criteria>
- [ ] goBack() uses router.navigate() with URL parsing
- [ ] No location.back() calls in goBack method
- [ ] Navigates to /hud/:projectId/:serviceId from sub-pages
- [ ] Navigates to /project/:projectId from main page
- [ ] Unused imports cleaned up
</success_criteria>

<output>
After completion, create `.planning/phases/05-navigation-refactor/05-02-SUMMARY.md`
</output>
