<ion-header>
  <ion-toolbar>
    <ion-title>Help Guide</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>
  <ion-refresher slot="fixed" (ionRefresh)="doRefresh($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-container">
    <ion-spinner name="crescent"></ion-spinner>
    <p>Loading help guide...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !loading" class="error-container">
    <ion-icon name="alert-circle-outline" class="error-icon"></ion-icon>
    <p>{{ error }}</p>
    <ion-button (click)="loadFiles()" fill="outline" size="small">
      Retry
    </ion-button>
  </div>

  <!-- File Sections -->
  <div *ngIf="!loading && !error" class="sections-container">
    <div *ngFor="let section of fileSections" class="file-section">
      <h2 class="section-title">{{ section.typeName }}</h2>
      
      <!-- Table Layout -->
      <div class="files-table">
        <ion-grid fixed>
          <ion-row *ngFor="let file of section.files" class="file-row">
            <!-- Description Column -->
            <ion-col size="8" size-md="9" class="description-col">
              <div class="file-description">
                <ion-icon name="document-text-outline" class="file-icon"></ion-icon>
                <span>{{ file.Description }}</span>
              </div>
            </ion-col>
            
            <!-- Preview Column -->
            <ion-col size="4" size-md="3" class="preview-col">
              <div class="preview-container" (click)="openFile(file)">
                <!-- Image Preview -->
                <div *ngIf="isImageFile(file.FileFile)" class="image-preview">
                  <img [src]="getCachedFileUrl(file.FileFile) || 'assets/img/photo-placeholder.svg'" 
                       [alt]="file.Description"
                       loading="lazy"
                       (error)="$event.target.src='assets/img/photo-placeholder.svg'">
                </div>
                
                <!-- PDF Preview -->
                <div *ngIf="isPdfFile(file.FileFile)" class="pdf-preview">
                  <div class="pdf-icon-container">
                    <ion-icon name="document-text" class="preview-icon"></ion-icon>
                    <span class="file-type">PDF</span>
                  </div>
                </div>
                
                <!-- Generic File Preview -->
                <div *ngIf="!isImageFile(file.FileFile) && !isPdfFile(file.FileFile)" 
                     class="generic-preview">
                  <ion-icon name="document" class="preview-icon"></ion-icon>
                  <span class="file-type">{{ getFileExtension(file.FileFile) }}</span>
                </div>
                
                <div class="preview-overlay">
                  <ion-icon name="eye-outline"></ion-icon>
                  <span>View</span>
                </div>
              </div>
            </ion-col>
          </ion-row>
        </ion-grid>
      </div>
    </div>

    <!-- Empty State -->
    <div *ngIf="fileSections.length === 0" class="empty-state">
      <ion-icon name="folder-open-outline" class="empty-icon"></ion-icon>
      <h3>No Help Files Available</h3>
      <p>Help guide files will appear here once they are uploaded.</p>
    </div>
  </div>
</ion-content>