<ion-header class="custom-header">
  <ion-toolbar class="action-toolbar" [class.web-centered]="platform.isWeb()">
    <ion-title>Support</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>
  <!-- Tab Segment -->
  <ion-segment [(ngModel)]="selectedTab" mode="ios" class="help-tabs">
    <ion-segment-button value="help">
      <ion-label>Help</ion-label>
    </ion-segment-button>
    <ion-segment-button value="onboarding">
      <ion-label>Onboarding</ion-label>
    </ion-segment-button>
    <ion-segment-button value="reports">
      <ion-label>Sample Reports</ion-label>
    </ion-segment-button>
  </ion-segment>

  <!-- Help Tab Content -->
  <div *ngIf="selectedTab === 'help'">
    <ion-refresher slot="fixed" (ionRefresh)="doRefresh($event)">
      <ion-refresher-content></ion-refresher-content>
    </ion-refresher>

    <!-- Loading State -->
    <div *ngIf="loading" class="loading-container">
      <ion-spinner name="crescent"></ion-spinner>
      <p>Loading help guide...</p>
    </div>

    <!-- Error State -->
    <div *ngIf="error && !loading" class="error-container">
      <ion-icon name="alert-circle-outline" class="error-icon"></ion-icon>
      <p>{{ error }}</p>
      <ion-button (click)="loadFiles()" fill="outline" size="small">
        Retry
      </ion-button>
    </div>

    <!-- File Sections -->
    <div *ngIf="!loading && !error" class="sections-container">
    <div *ngFor="let section of fileSections" class="file-section">
      <h2 class="section-title">{{ section.typeName }}</h2>
      
      <!-- Table Layout -->
      <div class="files-table">
        <ion-grid fixed>
          <ion-row *ngFor="let file of section.files" class="file-row">
            <!-- Description Column -->
            <ion-col size="8" size-md="9" class="description-col">
              <div class="file-description">
                <ion-icon name="document-text-outline" class="file-icon"></ion-icon>
                <span>{{ file.Description }}</span>
              </div>
            </ion-col>
            
            <!-- Preview Column -->
            <ion-col size="4" size-md="3" class="preview-col">
              <div class="preview-container" (click)="openFile(file)">
                <!-- Image Preview -->
                <div *ngIf="isImageFile(file.FileFile)" class="image-preview">
                  <img [src]="getCachedFileUrl(file.FileFile) || 'assets/img/photo-placeholder.svg'" 
                       [alt]="file.Description"
                       loading="lazy"
                       (error)="$event.target.src='assets/img/photo-placeholder.svg'">
                </div>
                
                <!-- PDF Preview -->
                <div *ngIf="isPdfFile(file.FileFile)" class="pdf-preview">
                  <ion-icon name="document-text" class="preview-icon"></ion-icon>
                  <span class="file-type">PDF</span>
                </div>
                
                <!-- Generic File Preview -->
                <div *ngIf="!isImageFile(file.FileFile) && !isPdfFile(file.FileFile)" 
                     class="generic-preview">
                  <ion-icon name="document" class="preview-icon"></ion-icon>
                  <span class="file-type">{{ getFileExtension(file.FileFile) }}</span>
                </div>
                
                <div class="preview-overlay">
                  <ion-icon name="eye-outline"></ion-icon>
                  <span>View</span>
                </div>
              </div>
            </ion-col>
          </ion-row>
        </ion-grid>
      </div>
    </div>

      <!-- Empty State -->
      <div *ngIf="fileSections.length === 0" class="empty-state">
        <ion-icon name="folder-open-outline" class="empty-icon"></ion-icon>
        <h3>No Help Files Available</h3>
        <p>Help guide files will appear here once they are uploaded.</p>
      </div>
    </div>
  </div>

  <!-- Onboarding Tab Content -->
  <div *ngIf="selectedTab === 'onboarding'" class="onboarding-container">
    <!-- First Video -->
    <div class="video-section">
      <h2 class="onboarding-title">1. Introduction to Noble Partnership</h2>
      <div class="video-wrapper">
        <div class="video-thumbnail" (click)="openYouTubeVideo('QshYGopHdqc')">
          <img src="https://img.youtube.com/vi/QshYGopHdqc/maxresdefault.jpg" 
               alt="Introduction to Noble Partnership"
               (error)="handleThumbnailError($event)">
          <div class="play-button">
            <ion-icon name="play-circle"></ion-icon>
          </div>
        </div>
      </div>
      <div class="video-description">
        <p>Watch this video to learn about the Noble Partnership and how to use the inspection app effectively.</p>
      </div>
    </div>

    <!-- Second Video -->
    <div class="video-section">
      <h2 class="onboarding-title">2. High Level Onboarding Process</h2>
      <div class="video-wrapper">
        <div class="video-thumbnail" (click)="openYouTubeVideo('0IW44h_8m2I')">
          <img src="https://img.youtube.com/vi/0IW44h_8m2I/maxresdefault.jpg" 
               alt="High Level Onboarding Process"
               (error)="handleThumbnailError($event)">
          <div class="play-button">
            <ion-icon name="play-circle"></ion-icon>
          </div>
        </div>
      </div>
      <div class="video-description">
        <p>Learn about the high-level onboarding process and best practices for getting started.</p>
      </div>
    </div>
  </div>

  <!-- Sample Reports Tab Content -->
  <div *ngIf="selectedTab === 'reports'" class="reports-container">
    <div class="empty-state">
      <ion-icon name="document-text-outline" class="empty-icon"></ion-icon>
      <h3>Sample Reports Coming Soon</h3>
      <p>Sample inspection reports will be available here.</p>
    </div>
  </div>
</ion-content>