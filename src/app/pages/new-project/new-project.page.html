<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-button (click)="goBack()" aria-label="Go back">
        <ion-icon name="arrow-back" aria-hidden="true"></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-title>Create New Project</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <form #projectForm="ngForm" (ngSubmit)="createProject()" aria-label="New project form">
    <!-- Hidden Company field with default value of 1 -->
    <input type="hidden" [(ngModel)]="formData.company" name="company" value="1">

    <!-- Hidden Inspection Date field with default value (today's date) -->
    <input type="hidden" [(ngModel)]="formData.inspectionDate" name="inspectionDate">

    <!-- PROPERTY ADDRESS Section -->
    <div class="form-section" role="group" aria-labelledby="property-address-heading">
      <h3 class="section-title" id="property-address-heading">PROPERTY ADDRESS</h3>

      <div class="field-wrapper">
        <ion-item lines="full" [class.item-error]="isWeb && shouldShowError('address')">
          <ion-label position="stacked" id="address-label">Street Address</ion-label>
          <input
            id="address-input"
            type="text"
            [(ngModel)]="formData.address"
            name="address"
            placeholder="Start typing an address..."
            class="native-input"
            [class.input-error]="isWeb && shouldShowError('address')"
            [attr.tabindex]="isWeb ? 1 : null"
            (blur)="onFieldBlur('address')"
            (input)="onFieldInput('address')"
            style="width: 100%; padding: 10px; border-radius: 4px; font-size: 16px; margin-top: 4px;"
            required
            aria-required="true"
            aria-labelledby="address-label"
            [attr.aria-invalid]="isWeb && shouldShowError('address')"
            [attr.aria-describedby]="isWeb && shouldShowError('address') ? 'address-error' : null">
        </ion-item>
        <div class="validation-error" *ngIf="isWeb && shouldShowError('address')" id="address-error" role="alert">
          <ion-icon name="alert-circle-outline" aria-hidden="true"></ion-icon>
          {{ getFieldError('address') }}
        </div>
      </div>

      <div class="field-wrapper">
        <ion-item lines="full" [class.item-error]="isWeb && shouldShowError('city')">
          <ion-label position="stacked" id="city-label">City</ion-label>
          <ion-input
            type="text"
            [(ngModel)]="formData.city"
            name="city"
            placeholder="City"
            [tabindex]="isWeb ? 2 : undefined"
            (ionBlur)="onFieldBlur('city')"
            (ionInput)="onFieldInput('city')"
            required
            aria-required="true"
            aria-labelledby="city-label"
            [attr.aria-invalid]="isWeb && shouldShowError('city')"
            [attr.aria-describedby]="isWeb && shouldShowError('city') ? 'city-error' : null">
          </ion-input>
        </ion-item>
        <div class="validation-error" *ngIf="isWeb && shouldShowError('city')" id="city-error" role="alert">
          <ion-icon name="alert-circle-outline" aria-hidden="true"></ion-icon>
          {{ getFieldError('city') }}
        </div>
      </div>

      <div class="field-wrapper">
        <ion-item lines="full" [class.item-error]="isWeb && shouldShowError('state')">
          <ion-label position="stacked" id="state-label">State</ion-label>
          <select
            [(ngModel)]="formData.state"
            name="state"
            required
            class="styled-input"
            [class.select-error]="isWeb && shouldShowError('state')"
            [attr.tabindex]="isWeb ? 3 : null"
            (blur)="onFieldBlur('state')"
            (change)="onFieldInput('state')"
            aria-required="true"
            aria-labelledby="state-label"
            [attr.aria-invalid]="isWeb && shouldShowError('state')"
            [attr.aria-describedby]="isWeb && shouldShowError('state') ? 'state-error' : null">
            <option [value]="null">-- Select --</option>
            <option *ngFor="let state of states" [value]="state.StateID">
              {{ state.State }}
            </option>
          </select>
        </ion-item>
        <div class="validation-error" *ngIf="isWeb && shouldShowError('state')" id="state-error" role="alert">
          <ion-icon name="alert-circle-outline" aria-hidden="true"></ion-icon>
          {{ getFieldError('state') }}
        </div>
      </div>

      <div class="field-wrapper">
        <ion-item lines="full" [class.item-error]="isWeb && shouldShowError('zip')">
          <ion-label position="stacked" id="zip-label">Zip Code</ion-label>
          <ion-input
            type="text"
            [(ngModel)]="formData.zip"
            name="zip"
            placeholder="Zip Code"
            pattern="[0-9]{5}"
            [tabindex]="isWeb ? 4 : undefined"
            (ionBlur)="onFieldBlur('zip')"
            (ionInput)="onFieldInput('zip')"
            required
            aria-required="true"
            aria-labelledby="zip-label"
            [attr.aria-invalid]="isWeb && shouldShowError('zip')"
            [attr.aria-describedby]="isWeb && shouldShowError('zip') ? 'zip-error' : null">
          </ion-input>
        </ion-item>
        <div class="validation-error" *ngIf="isWeb && shouldShowError('zip')" id="zip-error" role="alert">
          <ion-icon name="alert-circle-outline" aria-hidden="true"></ion-icon>
          {{ getFieldError('zip') }}
        </div>
      </div>
    </div>

    <!-- Submit Button -->
    <div class="button-container">
      <button
        type="submit"
        class="create-project-btn"
        [class.incomplete]="!isFormValid()"
        [disabled]="!isFormValid()"
        [tabindex]="isWeb ? 5 : undefined"
        [attr.aria-disabled]="!isFormValid()">
        <ion-icon name="add-circle-outline"></ion-icon>
        <span>Create Project</span>
      </button>
    </div>
  </form>
</ion-content>

<!-- Bottom tab bar -->
<ion-tab-bar slot="bottom" class="page-tab-bar custom-tab-bar">
  <ion-tab-button class="tab-button" (click)="router.navigateByUrl('/tabs/active-projects')">
    <ion-icon name="document-text-outline" class="tab-icon"></ion-icon>
    <ion-label class="tab-label">Active</ion-label>
  </ion-tab-button>
  <ion-tab-button class="tab-button" (click)="router.navigateByUrl('/tabs/all-projects')">
    <ion-icon name="folder-outline" class="tab-icon"></ion-icon>
    <ion-label class="tab-label">Complete</ion-label>
  </ion-tab-button>
  <ion-tab-button class="tab-button" (click)="router.navigateByUrl('/tabs/help-guide')">
    <ion-icon name="help-circle-outline" class="tab-icon"></ion-icon>
    <ion-label class="tab-label">Help</ion-label>
  </ion-tab-button>
  <ion-tab-button class="tab-button" (click)="router.navigateByUrl('/tabs/company')">
    <ion-icon name="people-outline" class="tab-icon"></ion-icon>
    <ion-label class="tab-label">Company</ion-label>
  </ion-tab-button>
</ion-tab-bar>