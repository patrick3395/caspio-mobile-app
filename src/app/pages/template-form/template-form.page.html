<ion-header>
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/tabs/active-projects"></ion-back-button>
    </ion-buttons>
    <ion-title>Engineer's Foundation Evaluation</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>
  <div class="template-container">
    <!-- Save status indicator -->
    <div class="save-status" *ngIf="saveStatus" [class.info]="saveStatusType === 'info'" 
         [class.success]="saveStatusType === 'success'" [class.error]="saveStatusType === 'error'">
      {{ saveStatus }}
    </div>
    
    <!-- Progress dots -->
    <div class="progress-dots">
      <span class="dot" [class.active]="currentSection === 1" 
            [class.completed]="sectionProgress['general'] > 80 && sectionProgress['information'] > 80 && sectionProgress['foundation'] > 80"
            (click)="goToSection(1)"></span>
      <span class="dot" [class.active]="currentSection === 2" 
            [class.completed]="sectionProgress['structural'] > 80"
            (click)="goToSection(2)"></span>
      <span class="dot" [class.active]="currentSection === 3" 
            [class.completed]="sectionProgress['elevation'] > 80"
            (click)="goToSection(3)"></span>
    </div>

    <form (ngSubmit)="submitForm()">
      <!-- Project Information Section (Shared across all services) -->
      <div class="section-card project-info-card">
        <div class="section-header project-header" (click)="toggleSection('project')">
          <div class="section-info">
            <div class="section-title">
              <ion-icon name="home-outline"></ion-icon>
              Project Information
            </div>
            <div class="section-description">Property details</div>
          </div>
          <div class="section-status">
            <span class="completion-indicator" [class.complete]="getProjectCompletion() === 100">
              {{getProjectCompletion()}}% Complete
            </span>
            <ion-icon [name]="expandedSections['project'] ? 'chevron-up' : 'chevron-down'"></ion-icon>
          </div>
        </div>
        
        <div class="section-content" *ngIf="expandedSections['project']">
          <!-- People & Roles -->
          <div class="info-group">
            <h3 class="group-title">
              <ion-icon name="people-outline"></ion-icon>
              People & Roles
            </h3>
            <div class="form-grid three-col">
              <!-- Client Name -->
              <div class="form-group" [class.filled]="projectData.ClientName">
                <label>
                  <ion-icon name="person-outline"></ion-icon>
                  Client Name
                </label>
                <input type="text" [(ngModel)]="projectData.ClientName" name="ClientName"
                       (ngModelChange)="onProjectFieldChange('ClientName', $event)"
                       placeholder="Enter client name"
                       class="styled-input">
              </div>

              <!-- Agent Name -->
              <div class="form-group" [class.filled]="projectData.AgentName">
                <label>
                  <ion-icon name="briefcase-outline"></ion-icon>
                  Agent Name
                </label>
                <input type="text" [(ngModel)]="projectData.AgentName" name="AgentName"
                       (ngModelChange)="onProjectFieldChange('AgentName', $event)"
                       placeholder="Enter agent name"
                       class="styled-input">
              </div>

              <!-- Inspector Name -->
              <div class="form-group" [class.filled]="projectData.InspectorName">
                <label>
                  <ion-icon name="clipboard-outline"></ion-icon>
                  Inspector Name
                </label>
                <input type="text" [(ngModel)]="projectData.InspectorName" name="InspectorName"
                       (ngModelChange)="onProjectFieldChange('InspectorName', $event)"
                       placeholder="Enter inspector name"
                       class="styled-input">
              </div>

              <!-- In Attendance -->
              <div class="form-group full-width" [class.filled]="projectData.InAttendance">
                <label>
                  <ion-icon name="people-circle-outline"></ion-icon>
                  In Attendance
                </label>
                <input type="text" [(ngModel)]="projectData.InAttendance" name="InAttendance"
                       (ngModelChange)="onProjectFieldChange('InAttendance', $event)"
                       placeholder="Who was present during inspection"
                       class="styled-input">
              </div>
            </div>
          </div>

          <!-- Property Details -->
          <div class="info-group">
            <h3 class="group-title">
              <ion-icon name="home-outline"></ion-icon>
              Property Details
            </h3>
            <div class="form-grid three-col">

              <!-- Year Built -->
              <div class="form-group" [class.filled]="projectData.YearBuilt">
                <label>
                  <ion-icon name="calendar-outline"></ion-icon>
                  Year Built
                </label>
                <input type="text" [(ngModel)]="projectData.YearBuilt" name="YearBuilt"
                       (ngModelChange)="onProjectFieldChange('YearBuilt', $event)"
                       placeholder="e.g., 1985"
                       class="styled-input">
              </div>

              <!-- Square Feet -->
              <div class="form-group" [class.filled]="projectData.SquareFeet">
                <label>
                  <ion-icon name="resize-outline"></ion-icon>
                  Square Feet
                </label>
                <input type="text" [(ngModel)]="projectData.SquareFeet" name="SquareFeet"
                       (ngModelChange)="onProjectFieldChange('SquareFeet', $event)"
                       placeholder="e.g., 2500"
                       class="styled-input">
              </div>

              <!-- Type of Building -->
              <div class="form-group" [class.filled]="projectData.TypeOfBuilding">
                <label>
                  <ion-icon name="business-outline"></ion-icon>
                  Building Type
                </label>
                <select [(ngModel)]="projectData.TypeOfBuilding" name="TypeOfBuilding"
                        (ngModelChange)="onProjectFieldChange('TypeOfBuilding', $event)"
                        class="styled-input">
                  <option value="">Select type</option>
                  <option value="Single Family">Single Family</option>
                  <option value="Multi Family">Multi Family</option>
                  <option value="Townhouse">Townhouse</option>
                  <option value="Condominium">Condominium</option>
                  <option value="Commercial">Commercial</option>
                </select>
              </div>

              <!-- Style -->
              <div class="form-group" [class.filled]="projectData.Style">
                <label>
                  <ion-icon name="home-outline"></ion-icon>
                  Style
                </label>
                <select [(ngModel)]="projectData.Style" name="Style"
                        (ngModelChange)="onProjectFieldChange('Style', $event)"
                        class="styled-input">
                  <option value="">Select style</option>
                  <option value="Ranch">Ranch</option>
                  <option value="Two Story">Two Story</option>
                  <option value="Split Level">Split Level</option>
                  <option value="Colonial">Colonial</option>
                  <option value="Contemporary">Contemporary</option>
                  <option value="Traditional">Traditional</option>
                </select>
              </div>

              <!-- Occupancy Furnishings -->
              <div class="form-group" [class.filled]="projectData.OccupancyFurnishings">
                <label>
                  <ion-icon name="bed-outline"></ion-icon>
                  Occupancy Status
                </label>
                <select [(ngModel)]="projectData.OccupancyFurnishings" name="OccupancyFurnishings"
                        (ngModelChange)="onProjectFieldChange('OccupancyFurnishings', $event)"
                        class="styled-input">
                  <option value="">Select status</option>
                  <option value="Occupied - Furnished">Occupied - Furnished</option>
                  <option value="Occupied - Unfurnished">Occupied - Unfurnished</option>
                  <option value="Vacant - Furnished">Vacant - Furnished</option>
                  <option value="Vacant - Unfurnished">Vacant - Unfurnished</option>
                </select>
              </div>
            </div>
          </div>

          <!-- Environmental Conditions -->
          <div class="info-group">
            <h3 class="group-title">
              <ion-icon name="partly-sunny-outline"></ion-icon>
              Environmental Conditions
            </h3>
            <div class="form-grid two-col">

              <!-- Weather Conditions -->
              <div class="form-group" [class.filled]="projectData.WeatherConditions">
                <label>
                  <ion-icon name="cloud-outline"></ion-icon>
                  Weather Conditions
                </label>
                <select [(ngModel)]="projectData.WeatherConditions" name="WeatherConditions"
                        (ngModelChange)="onProjectFieldChange('WeatherConditions', $event)"
                        class="styled-input">
                  <option value="">Select weather</option>
                  <option value="Clear">Clear</option>
                  <option value="Partly Cloudy">Partly Cloudy</option>
                  <option value="Cloudy">Cloudy</option>
                  <option value="Light Rain">Light Rain</option>
                  <option value="Heavy Rain">Heavy Rain</option>
                  <option value="Windy">Windy</option>
                  <option value="Foggy">Foggy</option>
                </select>
              </div>

              <!-- Outdoor Temperature -->
              <div class="form-group" [class.filled]="projectData.OutdoorTemperature">
                <label>
                  <ion-icon name="thermometer-outline"></ion-icon>
                  Outdoor Temperature
                </label>
                <input type="text" [(ngModel)]="projectData.OutdoorTemperature" name="OutdoorTemperature"
                       (ngModelChange)="onProjectFieldChange('OutdoorTemperature', $event)"
                       placeholder="e.g., 75Â°F"
                       class="styled-input">
              </div>
            </div>
          </div>

          <!-- Foundation Information -->
          <div class="info-group">
            <h3 class="group-title">
              <ion-icon name="layers-outline"></ion-icon>
              Foundation Details
            </h3>
            <div class="form-grid">

              <!-- Foundation Cards -->
              <div class="foundation-card primary">
                <div class="foundation-header">
                  <span class="foundation-badge">Primary</span>
                </div>
                <div class="form-group" [class.filled]="projectData.FirstFoundationType">
                  <label>Foundation Type</label>
                  <select [(ngModel)]="projectData.FirstFoundationType" name="FirstFoundationType"
                          (ngModelChange)="onProjectFieldChange('FirstFoundationType', $event)"
                          class="styled-input">
                    <option value="">Select type</option>
                    <option value="Slab on Grade">Slab on Grade</option>
                    <option value="Pier and Beam">Pier and Beam</option>
                    <option value="Basement">Basement</option>
                    <option value="Crawl Space">Crawl Space</option>
                  </select>
                </div>
              </div>

              <div class="foundation-card secondary" *ngIf="projectData.FirstFoundationType">
                <div class="foundation-header">
                  <span class="foundation-badge secondary">Secondary</span>
                  <span class="optional-text">(if applicable)</span>
                </div>
                <div class="form-group" [class.filled]="projectData.SecondFoundationType">
                  <label>Foundation Type</label>
                  <select [(ngModel)]="projectData.SecondFoundationType" name="SecondFoundationType"
                          (ngModelChange)="onProjectFieldChange('SecondFoundationType', $event)"
                          class="styled-input">
                    <option value="">Select type</option>
                    <option value="Slab on Grade">Slab on Grade</option>
                    <option value="Pier and Beam">Pier and Beam</option>
                    <option value="Basement">Basement</option>
                    <option value="Crawl Space">Crawl Space</option>
                  </select>
                </div>
                <div class="form-group" [class.filled]="projectData.SecondFoundationRooms">
                  <label>Affected Rooms</label>
                  <input type="text" [(ngModel)]="projectData.SecondFoundationRooms" name="SecondFoundationRooms"
                         (ngModelChange)="onProjectFieldChange('SecondFoundationRooms', $event)"
                         placeholder="e.g., Master bedroom, Kitchen"
                         class="styled-input">
                </div>
              </div>

              <div class="foundation-card tertiary" *ngIf="projectData.SecondFoundationType">
                <div class="foundation-header">
                  <span class="foundation-badge tertiary">Tertiary</span>
                  <span class="optional-text">(if applicable)</span>
                </div>
                <div class="form-group" [class.filled]="projectData.ThirdFoundationType">
                  <label>Foundation Type</label>
                  <select [(ngModel)]="projectData.ThirdFoundationType" name="ThirdFoundationType"
                          (ngModelChange)="onProjectFieldChange('ThirdFoundationType', $event)"
                          class="styled-input">
                    <option value="">Select type</option>
                    <option value="Slab on Grade">Slab on Grade</option>
                    <option value="Pier and Beam">Pier and Beam</option>
                    <option value="Basement">Basement</option>
                    <option value="Crawl Space">Crawl Space</option>
                  </select>
                </div>
                <div class="form-group" [class.filled]="projectData.ThirdFoundationRooms">
                  <label>Affected Rooms</label>
                  <input type="text" [(ngModel)]="projectData.ThirdFoundationRooms" name="ThirdFoundationRooms"
                         (ngModelChange)="onProjectFieldChange('ThirdFoundationRooms', $event)"
                         placeholder="e.g., Garage, Addition"
                         class="styled-input">
                </div>
              </div>

            </div>
          </div>

          <!-- Owner Interview -->
          <div class="info-group">
            <h3 class="group-title">
              <ion-icon name="chatbubbles-outline"></ion-icon>
              Owner/Occupant Interview
            </h3>
            <div class="form-grid">
              <div class="form-group full-width" [class.filled]="projectData.OwnerOccupantInterview">
                <label>Interview Notes & Observations</label>
                <textarea [(ngModel)]="projectData.OwnerOccupantInterview" name="OwnerOccupantInterview"
                          (ngModelChange)="onProjectFieldChange('OwnerOccupantInterview', $event)"
                          rows="5"
                          placeholder="Document owner concerns, observations, history of issues, repairs, etc."
                          class="styled-input"></textarea>
                <span class="char-count" *ngIf="projectData.OwnerOccupantInterview">
                  {{projectData.OwnerOccupantInterview.length}} characters
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Information Section -->
      <div class="section-card">
        <div class="section-header" (click)="toggleSection(1)">
          <div class="section-info">
            <div class="section-title">
              <span class="section-icon">ðŸ“‹</span>
              Information
            </div>
            <div class="section-description">Project details and contact information</div>
          </div>
          <ion-icon [name]="expandedSections[1] ? 'chevron-up' : 'chevron-down'"></ion-icon>
        </div>
        
        <div class="section-content" *ngIf="expandedSections[1]">
          <!-- General Subsection -->
          <div class="subsection-card">
            <div class="subsection-header" (click)="toggleSubsection('general')">
              <span class="subsection-title">General (Service_EFE Data)</span>
              <span class="completion-badge" 
                    [class.complete]="getGeneralCompletion() === 100"
                    [class.partial]="getGeneralCompletion() > 0 && getGeneralCompletion() < 100"
                    [class.empty]="getGeneralCompletion() === 0">{{getGeneralCompletion()}}%</span>
              <ion-icon [name]="expandedSubsections['general'] ? 'chevron-up' : 'chevron-down'"></ion-icon>
            </div>
            
            <div class="subsection-content" *ngIf="expandedSubsections['general']">
              <div class="form-row">
                <ion-item [class.completed]="hasValue('primaryPhoto')">
                  <ion-label position="stacked" [class.completed]="hasValue('primaryPhoto')">
                    <span *ngIf="hasValue('primaryPhoto')">âœ“ </span>Primary Photo
                  </ion-label>
                  <input type="file" (change)="onFileSelected($event, 'primaryPhoto')" accept="image/*">
                </ion-item>
              </div>

              <div class="form-row">
                <ion-item [class.completed]="hasValue('inspectionDate')">
                  <ion-label position="stacked" [class.completed]="hasValue('inspectionDate')">
                    <span *ngIf="hasValue('inspectionDate')">âœ“ </span>Date of Inspection
                  </ion-label>
                  <ion-datetime [(ngModel)]="formData.inspectionDate" name="inspectionDate" 
                                displayFormat="MM/DD/YYYY"
                                (ionChange)="onFieldChange('inspectionDate', $event.detail.value)"
                                [class.has-value]="hasValue('inspectionDate')"></ion-datetime>
                </ion-item>
              </div>

              <div class="form-row">
                <ion-item [class.completed]="hasValue('buildingType')">
                  <ion-label position="stacked" [class.completed]="hasValue('buildingType')">
                    <span *ngIf="hasValue('buildingType')">âœ“ </span>Type of Building
                  </ion-label>
                  <ion-select [(ngModel)]="formData.buildingType" name="buildingType"
                              (ionChange)="onFieldChange('buildingType', $event.detail.value)"
                              [class.has-value]="hasValue('buildingType')">
                    <ion-select-option value="Single Family">Single Family</ion-select-option>
                    <ion-select-option value="Multi Family">Multi Family</ion-select-option>
                    <ion-select-option value="Townhouse">Townhouse</ion-select-option>
                    <ion-select-option value="Condominium">Condominium</ion-select-option>
                    <ion-select-option value="Commercial">Commercial</ion-select-option>
                    <ion-select-option value="Mixed Use">Mixed Use</ion-select-option>
                  </ion-select>
                </ion-item>
              </div>

              <div class="form-row">
                <ion-item [class.completed]="hasValue('style')">
                  <ion-label position="stacked" [class.completed]="hasValue('style')">
                    <span *ngIf="hasValue('style')">âœ“ </span>Style
                  </ion-label>
                  <ion-select [(ngModel)]="formData.style" name="style"
                              (ionChange)="onFieldChange('style', $event.detail.value)"
                              [class.has-value]="hasValue('style')">
                    <ion-select-option value="">Select Style</ion-select-option>
                    <ion-select-option value="Ranch">Ranch</ion-select-option>
                    <ion-select-option value="Two Story">Two Story</ion-select-option>
                    <ion-select-option value="Split Level">Split Level</ion-select-option>
                    <ion-select-option value="Colonial">Colonial</ion-select-option>
                    <ion-select-option value="Contemporary">Contemporary</ion-select-option>
                    <ion-select-option value="Traditional">Traditional</ion-select-option>
                    <ion-select-option value="Mediterranean">Mediterranean</ion-select-option>
                    <ion-select-option value="Victorian">Victorian</ion-select-option>
                    <ion-select-option value="Craftsman">Craftsman</ion-select-option>
                  </ion-select>
                </ion-item>
              </div>

              <div class="form-row">
                <ion-item [class.completed]="hasValue('attendance')">
                  <ion-label position="stacked" [class.completed]="hasValue('attendance')">
                    <span *ngIf="hasValue('attendance')">âœ“ </span>In Attendance
                  </ion-label>
                  <ion-textarea [(ngModel)]="formData.attendance" name="attendance" 
                                placeholder="Names of people present"
                                (ionChange)="onFieldChange('attendance', $event.detail.value)"
                                [class.has-value]="hasValue('attendance')"></ion-textarea>
                </ion-item>
              </div>

              <div class="form-row">
                <ion-item [class.completed]="hasValue('weather')">
                  <ion-label position="stacked" [class.completed]="hasValue('weather')">
                    <span *ngIf="hasValue('weather')">âœ“ </span>Weather Conditions
                  </ion-label>
                  <ion-select [(ngModel)]="formData.weather" name="weather"
                              (ionChange)="onFieldChange('weather', $event.detail.value)"
                              [class.has-value]="hasValue('weather')">
                    <ion-select-option value="">Select Weather</ion-select-option>
                    <ion-select-option value="Clear">Clear</ion-select-option>
                    <ion-select-option value="Partly Cloudy">Partly Cloudy</ion-select-option>
                    <ion-select-option value="Cloudy">Cloudy</ion-select-option>
                    <ion-select-option value="Light Rain">Light Rain</ion-select-option>
                    <ion-select-option value="Heavy Rain">Heavy Rain</ion-select-option>
                    <ion-select-option value="Windy">Windy</ion-select-option>
                    <ion-select-option value="Foggy">Foggy</ion-select-option>
                    <ion-select-option value="Snow">Snow</ion-select-option>
                  </ion-select>
                </ion-item>
              </div>

              <div class="form-row">
                <ion-item [class.completed]="hasValue('temperature')">
                  <ion-label position="stacked" [class.completed]="hasValue('temperature')">
                    <span *ngIf="hasValue('temperature')">âœ“ </span>Outdoor Temperature (Â°F)
                  </ion-label>
                  <ion-input [(ngModel)]="formData.temperature" name="temperature" type="number" 
                             placeholder="e.g., 75"
                             (ionChange)="onFieldChange('temperature', $event.detail.value)"
                             [class.has-value]="hasValue('temperature')"></ion-input>
                </ion-item>
              </div>

              <div class="form-row">
                <ion-item [class.completed]="hasValue('occupancy')">
                  <ion-label position="stacked" [class.completed]="hasValue('occupancy')">
                    <span *ngIf="hasValue('occupancy')">âœ“ </span>Occupancy/Furnishings
                  </ion-label>
                  <ion-select [(ngModel)]="formData.occupancy" name="occupancy"
                              (ionChange)="onFieldChange('occupancy', $event.detail.value)"
                              [class.has-value]="hasValue('occupancy')">
                    <ion-select-option value="">Select Status</ion-select-option>
                    <ion-select-option value="Occupied - Furnished">Occupied - Furnished</ion-select-option>
                    <ion-select-option value="Occupied - Partially Furnished">Occupied - Partially Furnished</ion-select-option>
                    <ion-select-option value="Vacant - Furnished">Vacant - Furnished</ion-select-option>
                    <ion-select-option value="Vacant - Partially Furnished">Vacant - Partially Furnished</ion-select-option>
                    <ion-select-option value="Vacant - Unfurnished">Vacant - Unfurnished</ion-select-option>
                    <ion-select-option value="Under Construction">Under Construction</ion-select-option>
                  </ion-select>
                </ion-item>
              </div>
            </div>
          </div>

          <!-- Information Subsection -->
          <div class="subsection-card">
            <div class="subsection-header" (click)="toggleSubsection('information')">
              <span class="subsection-title">Information</span>
              <ion-icon [name]="expandedSubsections['information'] ? 'chevron-up' : 'chevron-down'"></ion-icon>
            </div>
            
            <div class="subsection-content" *ngIf="expandedSubsections['information']">
              <div class="form-row">
                <ion-item>
                  <ion-label position="stacked">Company</ion-label>
                  <ion-select [(ngModel)]="formData.company" name="company">
                    <ion-select-option value="Noble Property Inspections">Noble Property Inspections</ion-select-option>
                  </ion-select>
                </ion-item>
              </div>

              <div class="form-row">
                <ion-item>
                  <ion-label position="stacked">User</ion-label>
                  <ion-select [(ngModel)]="formData.user" name="user">
                    <ion-select-option value="Patrick Bullock">Patrick Bullock</ion-select-option>
                  </ion-select>
                </ion-item>
              </div>

              <div class="form-row">
                <ion-item>
                  <ion-label position="stacked">Date of Request</ion-label>
                  <ion-datetime [(ngModel)]="formData.date" name="date" displayFormat="MM/DD/YYYY"></ion-datetime>
                </ion-item>
              </div>

              <div class="form-row">
                <ion-item>
                  <ion-label position="stacked">Requested Address</ion-label>
                  <ion-input [(ngModel)]="formData.requestedAddress" name="requestedAddress"></ion-input>
                </ion-item>
              </div>

              <ion-row>
                <ion-col size="6">
                  <ion-item>
                    <ion-label position="stacked">City</ion-label>
                    <ion-input [(ngModel)]="formData.city" name="city"></ion-input>
                  </ion-item>
                </ion-col>
                <ion-col size="3">
                  <ion-item>
                    <ion-label position="stacked">State</ion-label>
                    <ion-select [(ngModel)]="formData.state" name="state">
                      <ion-select-option value="TX">TX</ion-select-option>
                    </ion-select>
                  </ion-item>
                </ion-col>
                <ion-col size="3">
                  <ion-item>
                    <ion-label position="stacked">Zip</ion-label>
                    <ion-input [(ngModel)]="formData.zip" name="zip"></ion-input>
                  </ion-item>
                </ion-col>
              </ion-row>

              <div class="form-row">
                <ion-item>
                  <ion-label position="stacked">Service Type</ion-label>
                  <ion-select [(ngModel)]="formData.serviceType" name="serviceType">
                    <ion-select-option value="Engineers Foundation Evaluation">Engineer's Foundation Evaluation</ion-select-option>
                    <ion-select-option value="Engineers Damaged Truss Evaluation">Engineer's Damaged Truss Evaluation</ion-select-option>
                  </ion-select>
                </ion-item>
              </div>

              <div class="form-row">
                <ion-item [class.completed]="hasValue('yearBuilt')">
                  <ion-label position="stacked" [class.completed]="hasValue('yearBuilt')">
                    <span *ngIf="hasValue('yearBuilt')">âœ“ </span>Year Built
                  </ion-label>
                  <ion-input [(ngModel)]="formData.yearBuilt" name="yearBuilt" type="number"
                             placeholder="e.g., 2005"
                             (ionChange)="onFieldChange('yearBuilt', $event.detail.value)"
                             [class.has-value]="hasValue('yearBuilt')"></ion-input>
                </ion-item>
              </div>

              <div class="form-row">
                <ion-item [class.completed]="hasValue('squareFootage')">
                  <ion-label position="stacked" [class.completed]="hasValue('squareFootage')">
                    <span *ngIf="hasValue('squareFootage')">âœ“ </span>Square Footage
                  </ion-label>
                  <ion-input [(ngModel)]="formData.squareFootage" name="squareFootage" type="number"
                             placeholder="e.g., 2500"
                             (ionChange)="onFieldChange('squareFootage', $event.detail.value)"
                             [class.has-value]="hasValue('squareFootage')"></ion-input>
                </ion-item>
              </div>

              <div class="form-row">
                <ion-item [class.completed]="hasValue('numberOfStories')">
                  <ion-label position="stacked" [class.completed]="hasValue('numberOfStories')">
                    <span *ngIf="hasValue('numberOfStories')">âœ“ </span>Number of Stories
                  </ion-label>
                  <ion-select [(ngModel)]="formData.numberOfStories" name="numberOfStories"
                              (ionChange)="onFieldChange('numberOfStories', $event.detail.value)"
                              [class.has-value]="hasValue('numberOfStories')">
                    <ion-select-option value="">Select Stories</ion-select-option>
                    <ion-select-option value="1">1</ion-select-option>
                    <ion-select-option value="1.5">1.5</ion-select-option>
                    <ion-select-option value="2">2</ion-select-option>
                    <ion-select-option value="2.5">2.5</ion-select-option>
                    <ion-select-option value="3">3</ion-select-option>
                    <ion-select-option value="3+">3+</ion-select-option>
                  </ion-select>
                </ion-item>
              </div>

              <div class="form-row">
                <ion-item [class.completed]="hasValue('exteriorCladding')">
                  <ion-label position="stacked" [class.completed]="hasValue('exteriorCladding')">
                    <span *ngIf="hasValue('exteriorCladding')">âœ“ </span>Exterior Cladding
                  </ion-label>
                  <ion-input [(ngModel)]="formData.exteriorCladding" name="exteriorCladding"
                             placeholder="e.g., Brick, Vinyl siding"
                             (ionChange)="onFieldChange('exteriorCladding', $event.detail.value)"
                             [class.has-value]="hasValue('exteriorCladding')"></ion-input>
                </ion-item>
              </div>

              <div class="form-row">
                <ion-item [class.completed]="hasValue('roofCovering')">
                  <ion-label position="stacked" [class.completed]="hasValue('roofCovering')">
                    <span *ngIf="hasValue('roofCovering')">âœ“ </span>Roof Covering
                  </ion-label>
                  <ion-input [(ngModel)]="formData.roofCovering" name="roofCovering"
                             placeholder="e.g., Asphalt shingles"
                             (ionChange)="onFieldChange('roofCovering', $event.detail.value)"
                             [class.has-value]="hasValue('roofCovering')"></ion-input>
                </ion-item>
              </div>
            </div>
          </div>

          <!-- Foundation Subsection -->
          <div class="subsection-card">
            <div class="subsection-header" (click)="toggleSubsection('foundation')">
              <span class="subsection-title">Foundation</span>
              <span class="completion-badge"
                    [class.complete]="sectionProgress['foundation'] === 100"
                    [class.partial]="sectionProgress['foundation'] > 0 && sectionProgress['foundation'] < 100"
                    [class.empty]="sectionProgress['foundation'] === 0">{{sectionProgress['foundation']}}%</span>
              <ion-icon [name]="expandedSubsections['foundation'] ? 'chevron-up' : 'chevron-down'"></ion-icon>
            </div>
            
            <div class="subsection-content" *ngIf="expandedSubsections['foundation']">
              <div class="form-row">
                <ion-item [class.completed]="hasValue('foundationType')">
                  <ion-label position="stacked" [class.completed]="hasValue('foundationType')">
                    <span *ngIf="hasValue('foundationType')">âœ“ </span>Foundation Type
                  </ion-label>
                  <ion-select [(ngModel)]="formData.foundationType" name="foundationType"
                              (ionChange)="onFieldChange('foundationType', $event.detail.value)"
                              [class.has-value]="hasValue('foundationType')">
                    <ion-select-option value="">Select Foundation Type</ion-select-option>
                    <ion-select-option value="Slab">Slab</ion-select-option>
                    <ion-select-option value="Pier and Beam">Pier and Beam</ion-select-option>
                    <ion-select-option value="Basement">Basement</ion-select-option>
                  </ion-select>
                </ion-item>
              </div>

              <div class="form-row">
                <ion-item [class.completed]="hasValue('foundationCondition')">
                  <ion-label position="stacked" [class.completed]="hasValue('foundationCondition')">
                    <span *ngIf="hasValue('foundationCondition')">âœ“ </span>Foundation Condition
                  </ion-label>
                  <ion-select [(ngModel)]="formData.foundationCondition" name="foundationCondition"
                              (ionChange)="onFieldChange('foundationCondition', $event.detail.value)"
                              [class.has-value]="hasValue('foundationCondition')">
                    <ion-select-option value="">Select Condition</ion-select-option>
                    <ion-select-option value="Good">Good</ion-select-option>
                    <ion-select-option value="Fair">Fair</ion-select-option>
                    <ion-select-option value="Poor">Poor</ion-select-option>
                  </ion-select>
                </ion-item>
              </div>

              <div class="form-row">
                <ion-item [class.completed]="hasValue('foundationNotes')">
                  <ion-label position="stacked" [class.completed]="hasValue('foundationNotes')">
                    <span *ngIf="hasValue('foundationNotes')">âœ“ </span>Foundation Notes
                  </ion-label>
                  <ion-textarea [(ngModel)]="formData.foundationNotes" name="foundationNotes" 
                                placeholder="Enter foundation observations and notes"
                                (ionChange)="onFieldChange('foundationNotes', $event.detail.value)"
                                [class.has-value]="hasValue('foundationNotes')"></ion-textarea>
                </ion-item>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Documents Section -->
      <div class="section-card documents-section">
        <div class="section-header documents-header" (click)="toggleSection(2)">
          <div class="section-info">
            <div class="section-title">
              <span class="section-icon">ðŸ“„</span>
              Documents & Reports
            </div>
            <div class="section-description">Service documentation and inspection reports</div>
          </div>
          <div class="section-status">
            <span class="doc-counter" [class.complete]="getUploadedDocumentsCount() > 0">
              {{getUploadedDocumentsCount()}} / {{getTotalDocumentsCount()}} Uploaded
            </span>
            <ion-icon [name]="expandedSections[2] ? 'chevron-up' : 'chevron-down'"></ion-icon>
          </div>
        </div>
        
        <div class="section-content" *ngIf="expandedSections[2]">
          <!-- Documents Grid -->
          <div class="documents-grid">
            
            <!-- Home Inspection Report -->
            <div class="document-card" [class.uploaded]="documentStatus['homeInspectionReport']">
              <div class="doc-header">
                <ion-icon name="document-text-outline" [class.uploaded]="documentStatus['homeInspectionReport']"></ion-icon>
                <h4>Home Inspection Report</h4>
                <span class="doc-status" *ngIf="documentStatus['homeInspectionReport']">
                  <ion-icon name="checkmark-circle"></ion-icon> Uploaded
                </span>
              </div>
              
              <div class="doc-content">
                <!-- Show filename if uploaded -->
                <div class="uploaded-file-info" *ngIf="documentStatus['homeInspectionReport']">
                  <div class="file-name">
                    <ion-icon name="attach-outline"></ion-icon>
                    <span>{{documentNames['homeInspectionReport'] || 'Document uploaded'}}</span>
                  </div>
                  <div class="file-meta">
                    Uploaded: {{documentDates['homeInspectionReport'] || 'Recently'}}
                  </div>
                </div>
                
                <!-- Upload area -->
                <div class="upload-area" *ngIf="!documentStatus['homeInspectionReport']">
                  <input type="file" 
                         id="homeInspectionReport" 
                         (change)="onDocumentSelected($event, 'homeInspectionReport', 'Home Inspection Report')"
                         accept=".pdf,.doc,.docx,.jpg,.jpeg,.png"
                         class="hidden-input">
                  <label for="homeInspectionReport" class="upload-button">
                    <ion-icon name="cloud-upload-outline"></ion-icon>
                    Select File
                  </label>
                  <span class="upload-hint">PDF, DOC, or Image files</span>
                </div>
                
                <!-- Link alternative -->
                <div class="link-alternative">
                  <label>Or provide a link:</label>
                  <input type="text" 
                         [(ngModel)]="formData.homeInspectionLink" 
                         name="homeInspectionLink"
                         placeholder="https://..."
                         class="link-input"
                         (change)="onLinkProvided('homeInspectionReport', $event)">
                </div>
                
                <!-- Actions for uploaded document -->
                <div class="doc-actions" *ngIf="documentStatus['homeInspectionReport']">
                  <button class="action-btn view" (click)="viewDocument('homeInspectionReport')">
                    <ion-icon name="eye-outline"></ion-icon> View
                  </button>
                  <button class="action-btn replace" (click)="replaceDocument('homeInspectionReport')">
                    <ion-icon name="swap-horizontal-outline"></ion-icon> Replace
                  </button>
                  <button class="action-btn remove" (click)="removeDocument('homeInspectionReport')">
                    <ion-icon name="trash-outline"></ion-icon> Remove
                  </button>
                </div>
              </div>
            </div>

            <!-- Engineer's Evaluation Report -->
            <div class="document-card" [class.uploaded]="documentStatus['engineersEvaluationReport']">
              <div class="doc-header">
                <ion-icon name="document-text-outline" [class.uploaded]="documentStatus['engineersEvaluationReport']"></ion-icon>
                <h4>Engineer's Evaluation Report</h4>
                <span class="doc-status" *ngIf="documentStatus['engineersEvaluationReport']">
                  <ion-icon name="checkmark-circle"></ion-icon> Uploaded
                </span>
              </div>
              
              <div class="doc-content">
                <!-- Show filename if uploaded -->
                <div class="uploaded-file-info" *ngIf="documentStatus['engineersEvaluationReport']">
                  <div class="file-name">
                    <ion-icon name="attach-outline"></ion-icon>
                    <span>{{documentNames['engineersEvaluationReport'] || 'Document uploaded'}}</span>
                  </div>
                  <div class="file-meta">
                    Uploaded: {{documentDates['engineersEvaluationReport'] || 'Recently'}}
                  </div>
                </div>
                
                <!-- Upload area -->
                <div class="upload-area" *ngIf="!documentStatus['engineersEvaluationReport']">
                  <input type="file" 
                         id="engineersEvaluationReport" 
                         (change)="onDocumentSelected($event, 'engineersEvaluationReport', 'Engineers Evaluation Report')"
                         accept=".pdf,.doc,.docx,.jpg,.jpeg,.png"
                         class="hidden-input">
                  <label for="engineersEvaluationReport" class="upload-button">
                    <ion-icon name="cloud-upload-outline"></ion-icon>
                    Select File
                  </label>
                  <span class="upload-hint">PDF, DOC, or Image files</span>
                </div>
                
                <!-- Link alternative -->
                <div class="link-alternative">
                  <label>Or provide a link:</label>
                  <input type="text" 
                         [(ngModel)]="formData.engineerLink" 
                         name="engineerLink"
                         placeholder="https://..."
                         class="link-input"
                         (change)="onLinkProvided('engineersEvaluationReport', $event)">
                </div>
                
                <!-- Actions for uploaded document -->
                <div class="doc-actions" *ngIf="documentStatus['engineersEvaluationReport']">
                  <button class="action-btn view" (click)="viewDocument('engineersEvaluationReport')">
                    <ion-icon name="eye-outline"></ion-icon> View
                  </button>
                  <button class="action-btn replace" (click)="replaceDocument('engineersEvaluationReport')">
                    <ion-icon name="swap-horizontal-outline"></ion-icon> Replace
                  </button>
                  <button class="action-btn remove" (click)="removeDocument('engineersEvaluationReport')">
                    <ion-icon name="trash-outline"></ion-icon> Remove
                  </button>
                </div>
              </div>
            </div>

            <!-- Support Documents -->
            <div class="document-card" [class.uploaded]="documentStatus['supportDocument']">
              <div class="doc-header">
                <ion-icon name="document-text-outline" [class.uploaded]="documentStatus['supportDocument']"></ion-icon>
                <h4>Support Documents</h4>
                <span class="doc-status" *ngIf="documentStatus['supportDocument']">
                  <ion-icon name="checkmark-circle"></ion-icon> Uploaded
                </span>
              </div>
              
              <div class="doc-content">
                <!-- Show filename if uploaded -->
                <div class="uploaded-file-info" *ngIf="documentStatus['supportDocument']">
                  <div class="file-name">
                    <ion-icon name="attach-outline"></ion-icon>
                    <span>{{documentNames['supportDocument'] || 'Document uploaded'}}</span>
                  </div>
                  <div class="file-meta">
                    Uploaded: {{documentDates['supportDocument'] || 'Recently'}}
                  </div>
                </div>
                
                <!-- Upload area -->
                <div class="upload-area" *ngIf="!documentStatus['supportDocument']">
                  <input type="file" 
                         id="supportDocument" 
                         (change)="onDocumentSelected($event, 'supportDocument', 'Support Document')"
                         accept=".pdf,.doc,.docx,.jpg,.jpeg,.png"
                         class="hidden-input">
                  <label for="supportDocument" class="upload-button">
                    <ion-icon name="cloud-upload-outline"></ion-icon>
                    Select File
                  </label>
                  <span class="upload-hint">PDF, DOC, or Image files</span>
                </div>
                
                <!-- Actions for uploaded document -->
                <div class="doc-actions" *ngIf="documentStatus['supportDocument']">
                  <button class="action-btn view" (click)="viewDocument('supportDocument')">
                    <ion-icon name="eye-outline"></ion-icon> View
                  </button>
                  <button class="action-btn replace" (click)="replaceDocument('supportDocument')">
                    <ion-icon name="swap-horizontal-outline"></ion-icon> Replace
                  </button>
                  <button class="action-btn remove" (click)="removeDocument('supportDocument')">
                    <ion-icon name="trash-outline"></ion-icon> Remove
                  </button>
                </div>
              </div>
            </div>

            <!-- Additional Documents Section -->
            <div class="document-card add-more">
              <div class="add-doc-content">
                <ion-icon name="add-circle-outline"></ion-icon>
                <h4>Additional Documents</h4>
                <p>Add any other relevant documents</p>
                <button class="add-doc-btn" (click)="addAdditionalDocument()">
                  <ion-icon name="add"></ion-icon> Add Document
                </button>
              </div>
              
              <!-- List of additional documents -->
              <div class="additional-docs-list" *ngIf="additionalDocuments.length > 0">
                <div class="additional-doc" *ngFor="let doc of additionalDocuments; let i = index">
                  <div class="file-name">
                    <ion-icon name="document-attach" class="uploaded"></ion-icon>
                    <span>{{doc.name}}</span>
                  </div>
                  <button class="remove-btn" (click)="removeAdditionalDocument(i)">
                    <ion-icon name="close-circle-outline"></ion-icon>
                  </button>
                </div>
              </div>
            </div>
            
          </div>
        </div>
      </div>

      <!-- Elevation Plot Section -->
      <div class="section-card">
        <div class="section-header" (click)="toggleSection(3)">
          <div class="section-info">
            <div class="section-title">
              <span class="section-icon">ðŸ“Š</span>
              Elevation Plot
            </div>
            <div class="section-description">Additional notes and measurements</div>
          </div>
          <ion-icon [name]="expandedSections[3] ? 'chevron-up' : 'chevron-down'"></ion-icon>
        </div>
        
        <div class="section-content" *ngIf="expandedSections[3]">
          <div class="form-row">
            <ion-item [class.completed]="hasValue('notes')">
              <ion-label position="stacked" [class.completed]="hasValue('notes')">
                <span *ngIf="hasValue('notes')">âœ“ </span>Notes
              </ion-label>
              <ion-textarea [(ngModel)]="formData.notes" name="notes" rows="6" 
                            placeholder="Enter any additional notes or observations"
                            (ionChange)="onFieldChange('notes', $event.detail.value)"
                            [class.has-value]="hasValue('notes')"></ion-textarea>
            </ion-item>
          </div>
        </div>
      </div>

      <!-- Service Fee and Submit -->
      <div class="footer-section">
        <div class="service-fee">
          Service Fee: <span class="fee-amount">${{serviceFee}}</span>
        </div>
        <ion-button expand="block" type="submit" color="primary" size="large">
          Submit
        </ion-button>
      </div>
    </form>
  </div>
</ion-content>