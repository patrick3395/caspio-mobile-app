<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <button class="header-icon-button cancel-button" (click)="dismiss()">
        <ion-icon name="close" class="orange-icon"></ion-icon>
      </button>
    </ion-buttons>
    <ion-title>Add {{ kind }}</ion-title>
    <ion-buttons slot="end">
      <button class="header-icon-button save-button" (click)="save()">
        <ion-icon name="checkmark" class="orange-icon"></ion-icon>
      </button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <div class="form-container">
    <!-- Name Input -->
    <ion-item>
      <ion-label position="stacked">Title/Name <span style="color: red;">*</span></ion-label>
      <ion-input
        [(ngModel)]="name"
        (ionInput)="onNameInput($event)"
        placeholder="Enter title/name"
        type="text"
        autocapitalize="sentences"
        autocorrect="on">
      </ion-input>
    </ion-item>

    <!-- Description Input -->
    <ion-item>
      <ion-label position="stacked">Description (Optional)</ion-label>
      <ion-textarea
        [(ngModel)]="description"
        (ionInput)="onDescriptionInput($event)"
        placeholder="Enter description"
        rows="4"
        autocapitalize="sentences"
        autocorrect="on">
      </ion-textarea>
    </ion-item>

    <!-- Photos Section -->
    <div class="photos-section">
      <h3>Photos</h3>

      <!-- Camera and Gallery Buttons -->
      <div style="display: flex; gap: 16px; margin-bottom: 16px; justify-content: center;">
        <button class="camera-button-structural" (click)="addPhotoFromCamera()" title="Take photo from camera">
          <ion-icon name="camera" style="font-size: 32px; color: var(--noble-orange, #F15A27);"></ion-icon>
        </button>
        <button class="camera-button-structural" (click)="addPhotosFromGallery()" title="Select from gallery">
          <ion-icon name="images" style="font-size: 32px; color: var(--noble-orange, #F15A27);"></ion-icon>
        </button>
      </div>

      <!-- Hidden File Input -->
      <input
        #fileInput
        type="file"
        accept="image/*"
        multiple
        (change)="onFileSelected($event)"
        style="display: none;">

      <!-- Photo Previews - Matching Structural Systems Style -->
      <div class="image-preview-container" *ngIf="processedPhotos.length > 0">
        <div class="image-preview structural-photo-preview"
             *ngFor="let photo of processedPhotos; let i = index"
             [class.annotated]="photo.hasAnnotations">
          <img [src]="photo.previewUrl"
               width="90"
               height="90"
               [alt]="'Photo ' + (i + 1)"
               (click)="editPhoto(i)"
               (error)="onImageError($event, i)"
               [class.has-annotations]="photo.hasAnnotations">

          <button class="delete-btn"
                  (click)="removePhoto(i); $event.stopPropagation()"
                  title="Delete">
            <ion-icon name="close"></ion-icon>
          </button>

          <button class="room-photo-caption"
                  (click)="editCaption(i); $event.stopPropagation()">
            {{ photo.caption || 'Caption' }}
          </button>
        </div>
      </div>

      <p class="photo-count" *ngIf="processedPhotos.length > 0">
        {{ processedPhotos.length }} photo(s) selected
      </p>
    </div>
  </div>
</ion-content>

