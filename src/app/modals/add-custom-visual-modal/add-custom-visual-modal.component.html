<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <button class="header-icon-button cancel-button" (click)="dismiss()" aria-label="Cancel and close">
        <ion-icon name="close" class="orange-icon" aria-hidden="true"></ion-icon>
      </button>
    </ion-buttons>
    <ion-title id="add-custom-modal-title">Add {{ kind }}</ion-title>
    <ion-buttons slot="end">
      <button class="header-icon-button save-button" (click)="save()" aria-label="Save">
        <ion-icon name="checkmark" class="orange-icon" aria-hidden="true"></ion-icon>
      </button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding" role="dialog" aria-labelledby="add-custom-modal-title">
  <div class="form-container">
    <!-- Name Input -->
    <ion-item>
      <ion-label position="stacked" id="name-label">Title/Name <span style="color: red;" aria-hidden="true">*</span></ion-label>
      <ion-input
        [(ngModel)]="name"
        (ionInput)="onNameInput($event)"
        placeholder="Enter title/name"
        type="text"
        autocapitalize="sentences"
        autocorrect="on"
        aria-labelledby="name-label"
        aria-required="true">
      </ion-input>
    </ion-item>

    <!-- Description Input -->
    <ion-item>
      <ion-label position="stacked" id="description-label">Description (Optional)</ion-label>
      <ion-textarea
        [(ngModel)]="description"
        (ionInput)="onDescriptionInput($event)"
        placeholder="Enter description"
        rows="4"
        autocapitalize="sentences"
        autocorrect="on"
        aria-labelledby="description-label">
      </ion-textarea>
    </ion-item>

    <!-- Photos Section -->
    <div class="photos-section" role="region" aria-label="Photos">
      <h3 id="photos-section-heading">Photos</h3>

      <!-- Camera and Gallery Buttons -->
      <div style="display: flex; gap: 16px; margin-bottom: 16px; justify-content: center;" role="group" aria-label="Add photos">
        <button class="camera-button-structural" *ngIf="!isWeb" (click)="addPhotoFromCamera()" aria-label="Take photo from camera">
          <ion-icon name="camera" style="font-size: 32px; color: var(--noble-orange, #F15A27);" aria-hidden="true"></ion-icon>
        </button>
        <button class="camera-button-structural" (click)="addPhotosFromGallery()" aria-label="Select photos from gallery">
          <ion-icon name="images" style="font-size: 32px; color: var(--noble-orange, #F15A27);" aria-hidden="true"></ion-icon>
        </button>
      </div>

      <!-- Hidden File Input -->
      <input
        #fileInput
        type="file"
        accept="image/*"
        multiple
        (change)="onFileSelected($event)"
        style="display: none;"
        aria-label="Select image files">

      <!-- Photo Previews - Matching Structural Systems Style -->
      <div class="image-preview-container" *ngIf="processedPhotos.length > 0" role="list" aria-label="Selected photos">
        <div class="image-preview structural-photo-preview"
             *ngFor="let photo of processedPhotos; let i = index"
             [class.annotated]="photo.hasAnnotations"
             role="listitem">
          <img [src]="photo.previewUrl"
               [alt]="'Photo ' + (i + 1) + (photo.caption ? ': ' + photo.caption : '')"
               (click)="editPhoto(i)"
               (error)="onImageError($event, i)"
               tabindex="0"
               (keydown.enter)="editPhoto(i)"
               [attr.aria-label]="'Photo ' + (i + 1) + ', click to edit'">

          <button class="delete-btn"
                  (click)="removePhoto(i); $event.stopPropagation()"
                  [attr.aria-label]="'Delete photo ' + (i + 1)">
            <ion-icon name="close" aria-hidden="true"></ion-icon>
          </button>

          <button class="room-photo-caption"
                  (click)="editCaption(i); $event.stopPropagation()"
                  [attr.aria-label]="'Edit caption for photo ' + (i + 1) + (photo.caption ? ', current caption: ' + photo.caption : ', no caption')">
            {{ photo.caption || 'Caption' }}
          </button>
        </div>
      </div>

      <p class="photo-count" *ngIf="processedPhotos.length > 0" aria-live="polite">
        {{ processedPhotos.length }} photo(s) selected
      </p>
    </div>
  </div>
</ion-content>

