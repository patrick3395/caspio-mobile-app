<div class="sync-widget" *ngIf="hasPendingItems()" [class.syncing]="syncStatus.isSyncing" (click)="showSyncDetails()">
  <ion-icon [name]="getStatusIcon()" [color]="getStatusColor()"></ion-icon>
  <span class="sync-count">{{ syncStatus.pendingCount }}</span>
</div>

<!-- Sync Details Modal -->
<div class="sync-modal-backdrop" *ngIf="showDetails" (click)="closeDetails()">
  <div class="sync-modal" (click)="$event.stopPropagation()">
    <div class="sync-modal-header">
      <h3>Sync Status</h3>
      <button class="close-btn" (click)="closeDetails()">
        <ion-icon name="close"></ion-icon>
      </button>
    </div>
    
    <div class="sync-modal-content">
      <!-- Summary -->
      <div class="sync-summary">
        <div class="sync-stat" [class.active]="syncStatus.isSyncing">
          <ion-icon name="sync" [class.spinning]="syncStatus.isSyncing"></ion-icon>
          <span>{{ syncStatus.isSyncing ? 'Syncing...' : 'Idle' }}</span>
        </div>
        <div class="sync-stat pending">
          <span class="count">{{ pendingRequests.length }}</span>
          <span class="label">Pending</span>
        </div>
        <div class="sync-stat syncing">
          <span class="count">{{ syncingRequests.length }}</span>
          <span class="label">Syncing</span>
        </div>
        <div class="sync-stat failed" *ngIf="failedRequests.length > 0">
          <span class="count">{{ failedRequests.length }}</span>
          <span class="label">Failed</span>
        </div>
      </div>

      <!-- Currently Syncing -->
      <div class="sync-section" *ngIf="syncingRequests.length > 0">
        <h4><ion-icon name="sync" class="spinning"></ion-icon> Currently Syncing</h4>
        <div class="request-list">
          <div class="request-item syncing" *ngFor="let req of syncingRequests">
            <ion-icon [name]="getRequestIcon(req)"></ion-icon>
            <span class="request-desc">{{ getRequestDescription(req) }}</span>
          </div>
        </div>
      </div>

      <!-- Pending Queue -->
      <div class="sync-section" *ngIf="pendingRequests.length > 0">
        <h4><ion-icon name="time-outline"></ion-icon> Waiting to Sync</h4>
        <div class="request-list">
          <div class="request-item" *ngFor="let req of pendingRequests; let i = index">
            <span class="queue-number">{{ i + 1 }}</span>
            <ion-icon [name]="getRequestIcon(req)"></ion-icon>
            <span class="request-desc">{{ getRequestDescription(req) }}</span>
            <span class="dependency-badge" *ngIf="req.dependencies?.length > 0" title="Waiting for dependencies">
              <ion-icon name="git-branch-outline"></ion-icon>
            </span>
          </div>
        </div>
      </div>

      <!-- Failed -->
      <div class="sync-section failed-section" *ngIf="failedRequests.length > 0">
        <h4><ion-icon name="alert-circle-outline"></ion-icon> Failed</h4>
        <div class="request-list">
          <div class="request-item failed" *ngFor="let req of failedRequests">
            <ion-icon [name]="getRequestIcon(req)"></ion-icon>
            <span class="request-desc">{{ getRequestDescription(req) }}</span>
            <span class="error-msg" *ngIf="req.error">{{ req.error }}</span>
          </div>
        </div>
      </div>

      <!-- Empty State -->
      <div class="empty-state" *ngIf="pendingRequests.length === 0 && syncingRequests.length === 0 && failedRequests.length === 0">
        <ion-icon name="checkmark-circle-outline" color="success"></ion-icon>
        <p>All changes synced!</p>
      </div>
    </div>

    <div class="sync-modal-footer">
      <button class="sync-btn" (click)="forceSync()" [disabled]="syncStatus.isSyncing">
        <ion-icon name="sync"></ion-icon>
        {{ syncStatus.isSyncing ? 'Syncing...' : 'Sync Now' }}
      </button>
      <button class="refresh-btn" (click)="refreshDetails()">
        <ion-icon name="refresh"></ion-icon>
        Refresh
      </button>
    </div>
  </div>
</div>
