{
  "name": "Caspio MOBILE APP - Dexie-First Implementation",
  "branchName": "feature/dexie-first-implementation",
  "userStories": [
    {
      "id": "US-001",
      "title": "[MOBILE APP] Add Debug ALERT Statements to Category Detail Photo Flow",
      "description": "INCOMPLETE - DEBUG MUST USE alert() NOT console.log. This is a MOBILE APP issue - console.log is NOT visible on mobile devices. Add alert() debug statements to category-detail page to diagnose why photos disappear after sync and why annotations don't show on reload. DEXIE-FIRST approach is mandatory.",
      "acceptanceCriteria": [
        "CRITICAL: Use alert() for ALL debug - console.log is NOT visible on mobile",
        "Add alert() on ionViewWillEnter to trace photo population flow",
        "Add alert() on photo upload to trace LocalImage creation and displayUrl assignment",
        "Add alert() on sync completion to trace what happens to displayUrl",
        "Add alert() for annotation loading from cachedAnnotatedImages on page reload",
        "Alert popups show complete flow from upload to display on MOBILE DEVICE",
        "Can identify exactly where displayUrl changes or is lost",
        "Can identify why annotations are not loading on reload"
      ],
      "technicalContext": [
        "MOBILE APP: Must test on actual mobile device or emulator",
        "MOBILE APP: console.log is NOT visible - use alert() instead",
        "Page: src/app/pages/engineers-foundation/structural-systems/category-detail",
        "DEXIE-FIRST: LocalImages table is source of truth for photos",
        "DEXIE-FIRST: displayUrl must ALWAYS point to local blob, NEVER swap to server URL"
      ],
      "priority": 1,
      "passes": false,
      "dependsOn": []
    },
    {
      "id": "US-002",
      "title": "[MOBILE APP] Fix Category Detail - Photo Disappears After Sync",
      "description": "MOBILE APP ISSUE: After syncing, the photo disappears from the UI. The implementation MUST continue to point to local data storage (Dexie LocalImages table) and NOT swap to synced server data. DEXIE-FIRST is non-negotiable.",
      "acceptanceCriteria": [
        "Review alert() debug output from US-001 to identify where displayUrl is swapped",
        "Ensure populatePhotosFromDexie always reads from LocalImages table",
        "Ensure sync completion does NOT modify displayUrl",
        "Photos remain visible after sync completes on MOBILE DEVICE",
        "displayUrl ALWAYS points to local blob (blob: or data:), NEVER server URL"
      ],
      "technicalContext": [
        "MOBILE APP: Test on actual mobile device",
        "Page: src/app/pages/engineers-foundation/structural-systems/category-detail",
        "DEXIE-FIRST: LocalImages table stores photos with stable imageId",
        "Sync should update metadata only, NOT displayUrl",
        "DO NOT abandon Dexie approach for alternative solutions"
      ],
      "priority": 1,
      "passes": false,
      "dependsOn": [
        "US-001"
      ]
    },
    {
      "id": "US-003",
      "title": "[MOBILE APP] Fix Category Detail - Annotations Missing on Reload",
      "description": "MOBILE APP ISSUE: On reload of the page, the photo thumbnail does not show annotations. Annotations should persist and display correctly after page reload. DEXIE-FIRST is non-negotiable.",
      "acceptanceCriteria": [
        "Review alert() debug output from US-001 to identify annotation loading flow",
        "Ensure cachedAnnotatedImages are loaded on page init",
        "Ensure getDisplayUrl checks for annotated image first",
        "Annotations display correctly on photo thumbnails after page reload on MOBILE DEVICE"
      ],
      "technicalContext": [
        "MOBILE APP: Test on actual mobile device",
        "Page: src/app/pages/engineers-foundation/structural-systems/category-detail",
        "Annotations stored in cachedAnnotatedImages table in Dexie",
        "DO NOT abandon Dexie approach for alternative solutions"
      ],
      "priority": 1,
      "passes": false,
      "dependsOn": [
        "US-001"
      ]
    },
    {
      "id": "US-004",
      "title": "[MOBILE APP] Add Debug ALERT Statements to Room Elevation Photo Flow",
      "description": "MOBILE APP ISSUE: Add alert() debug statements (NOT console.log) to room-elevation page to diagnose photo issues. Photos don't show on upload, don't persist on reload, disappear after sync, and annotations/captions don't persist. DEXIE-FIRST approach is mandatory.",
      "acceptanceCriteria": [
        "CRITICAL: Use alert() for ALL debug - console.log is NOT visible on mobile",
        "Add alert() on ionViewWillEnter to trace photo population flow",
        "Add alert() on photo upload to trace LocalImage creation and displayUrl assignment",
        "Add alert() on sync completion to trace what happens to displayUrl",
        "Add alert() for annotation/caption loading on page reload",
        "Alert popups show complete flow from upload to display on MOBILE DEVICE",
        "Can identify exactly where photos are lost"
      ],
      "technicalContext": [
        "MOBILE APP: Must test on actual mobile device or emulator",
        "MOBILE APP: console.log is NOT visible - use alert() instead",
        "Page: src/app/pages/engineers-foundation/room-elevation",
        "DEXIE-FIRST: LocalImages table is source of truth for photos",
        "Room has multiple elevation points (Point1-Point20)"
      ],
      "priority": 2,
      "passes": false,
      "dependsOn": []
    },
    {
      "id": "US-005",
      "title": "[MOBILE APP] Create Dexie Table and Repository for EFE Data",
      "description": "MOBILE APP ISSUE: The elevation plot section has a DIFFERENT data structure than structural systems. Create a NEW Dexie table for EFE room/point data (similar to VisualFieldRepo but for EFE structure). DEXIE-FIRST is non-negotiable.",
      "acceptanceCriteria": [
        "Create EfeField interface in caspio-db.ts",
        "Add efeFields table to Dexie schema",
        "Create EfeFieldRepoService following VisualFieldRepo pattern",
        "Implement getRoom, getPoint, setField, setPhoto methods",
        "Implement liveQuery subscription for reactive updates",
        "Test on MOBILE DEVICE to verify data persists"
      ],
      "technicalContext": [
        "MOBILE APP: Test on actual mobile device",
        "Location: src/app/services",
        "DEXIE-FIRST: New table required for EFE data structure",
        "Must integrate with existing EFE sync process without breaking it"
      ],
      "priority": 2,
      "passes": false,
      "dependsOn": [
        "US-004"
      ]
    },
    {
      "id": "US-006",
      "title": "[MOBILE APP] Fix Room Elevation - All Photo Issues",
      "description": "MOBILE APP ISSUE: Fix all photo issues in room-elevation: (1) Photo doesn't show on upload, (2) Photo doesn't persist on reload, (3) Photo disappears after sync, (4) Annotations/captions don't persist. DEXIE-FIRST is non-negotiable.",
      "acceptanceCriteria": [
        "Integrate EfeFieldRepoService from US-005",
        "Photos display immediately after capture on MOBILE DEVICE",
        "Photos persist after page navigation and reload on MOBILE DEVICE",
        "Photos remain visible after sync on MOBILE DEVICE",
        "Annotations and captions persist across navigation/reload",
        "displayUrl ALWAYS points to local blob, NEVER server URL"
      ],
      "technicalContext": [
        "MOBILE APP: Test on actual mobile device",
        "Page: src/app/pages/engineers-foundation/room-elevation",
        "DEXIE-FIRST: LocalImages table is source of truth",
        "FDF section has separate photo slots (top, bottom, etc.)",
        "DO NOT abandon Dexie approach for alternative solutions"
      ],
      "priority": 2,
      "passes": false,
      "dependsOn": [
        "US-004",
        "US-005"
      ]
    }
  ],
  "metadata": {
    "updatedAt": "2026-01-15T19:00:00.000Z"
  }
}
